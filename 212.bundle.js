"use strict";(self.webpackChunkreact_wyz=self.webpackChunkreact_wyz||[]).push([[212],{5212:(n,e,t)=>{t.r(e),t.d(e,{default:()=>o});const o="vue 是一个 js 框架，它实现了自己的模板，通过 .vue 文件可以经过编译成一个数据改变驱动视图改变的 js代码。\n那么这其中又是经历了什么样的步骤呢？\n\n----- \n一个 vue 对象是通过 new Vue({options}) 来得到的，也就是构造函数了。我们来看这个函数\n```\nfunction Vue (options) {\n  if (process.env.NODE_ENV !== 'production' &&\n    !(this instanceof Vue)\n  ) {\n    warn('Vue is a constructor and should be called with the `new` keyword')\n  }\n  this._init(options)\n}\n\n// 这里是一系列对这个函数进行的继承\ninitMixin(Vue)\nstateMixin(Vue)\neventsMixin(Vue)\nlifecycleMixin(Vue)\nrenderMixin(Vue)\n\nexport default Vue\n```\n可以看到这个 Vue 构造函数，它经历了 5 个系列的mixin，并在新创建时会运行 _init(options) 方法。\n那么我们来看看, 这五个 mixin 分别做了啥。\n\n ##### 第一个  initMixin\n 它只做了一件事， 定义了 _init 方法，那么你就知道创造一个Vue 实例，它执行的 _init 方法就是上面这个方法了。\n```\nVue.prototype._init = function (options?: Object) {\n....\n}\n```\n\n\n\n##### 第二个 stateMixin \n```\n  Object.defineProperty(Vue.prototype, '$data', dataDef)  // 能够返回 data\n  Object.defineProperty(Vue.prototype, '$props', propsDef) // 能够返回 props\n  Vue.prototype.$set = set // 就是我们用的 this.$set(this.people, 'name', ‘clever')方法, 下同。\n  Vue.prototype.$delete = del\n  Vue.prototype.$watch = function (\n   ....\n  }\n  ```\n\n##### 第三个 eventsMixin\n```\nVue.prototype.$on = function (eventname, fn) {\n....\n}\nVue.prototype._$once = function (eventname, fn) {\n // 监听一个自定义事件，但是只触发一次，在第一次触发之后移除监听器。\n}\nVue.prototype._off = function (event, fn) {\n// 移除自定义事件监听器。\n}\nVue.prototype.$emit = function (event) {\n// 触发一个事件\n}\n```\n##### 第四个 lifecycleMixin![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/0227c8c15285fbd179573e7cd8cb4718.png)\n##### 第五个 renderMixin![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/715399a9ac35cef7c3aca2d3242ca5a3.png)\n---\n\n好， 这个 Vue 继承了这些方法，它已经是一个完整的 Vue 了，而新创建的时候要执行 _init 方法了, 现在我们来看看这个方法里面做了写啥\n-  vm._uid = uid++ 创建 uid\n-  合并 options\n-   initLifecycle\n    initEvents(vm)\n    initRender(vm)\n    callHook(vm, 'beforeCreate')\n    initInjections(vm) // resolve injections before data/props\n    initState(vm)\n    initProvide(vm) // resolve provide after data/props\n    callHook(vm, 'created')\n```\n关于 initLifecycle\n  vm.$parent = parent\n  vm.$root = parent ? parent.$root : vm\n  vm.$children = []\n  vm.$refs = {}\n  vm._watcher = null\n  vm._inactive = null\n  vm._directInactive = false\n  vm._isMounted = false\n  vm._isDestroyed = false\n  vm._isBeingDestroyed = false\n  ```\n\n-  initEvents\n```\n  vm._events = Object.create(null)\n  vm._hasHookEvent = false\n  // init parent attached events\n  const listeners = vm.$options._parentListeners\n  if (listeners) {\n    updateComponentListeners(vm, listeners)\n  }\n  就是判断父级是否有事件监听，然后给父级进行监听事件\n  ```\n- initRender\n```\n   vm._vnode = null  // the root of the child tree\n  vm._staticTrees = null  // v-once cached trees\n  const options = vm.$options\n  const parentVnode = vm.$vnode = options._parentVnode // the placeholder node in parent tree\n  const renderContext = parentVnode && parentVnode.context\n  vm.$slots = resolveSlots(options._renderChildren, renderContext)\n  vm.$scopedSlots = emptyObject\n  // 实例绑定 createElement 方法，以便可以正常在内部渲染\n // 参数顺序   tag, data, children, normalizationType, alwaysNormalize\n  // 内部使用从模板编译而来的渲染函数\n  \n  vm._c = (a, b, c, d) => createElement(vm, a, b, c, d, false)\n  // 公共版本必须是 normalization 的渲染函数\n  vm.$createElement = (a, b, c, d) => createElement(vm, a, b, c, d, true)\n\n  // $attrs & $listeners 应该被监听热更新\n  const parentData = parentVnode && parentVnode.data\n\n  if (process.env.NODE_ENV !== 'production') {\n    defineReactive(vm, '$attrs', parentData && parentData.attrs || emptyObject, () => {\n      !isUpdatingChildComponent && warn(`$attrs is readonly.`, vm)\n    }, true)\n    defineReactive(vm, '$listeners', options._parentListeners || emptyObject, () => {\n      !isUpdatingChildComponent && warn(`$listeners is readonly.`, vm)\n    }, true)\n  } else {\n    defineReactive(vm, '$attrs', parentData && parentData.attrs || emptyObject, null, true)\n    defineReactive(vm, '$listeners', options._parentListeners || emptyObject, null, true)\n  }\n  ```\n-  callHook(vm, 'beforeCreate') 执行 beforeCreate 函数\n\n-  initInjections(vm) 收集注入的依赖\n```\n  const result = resolveInject(vm.$options.inject, vm)\n  if (result) {\n    toggleObserving(false)\n    Object.keys(result).forEach(key => {\n      if (process.env.NODE_ENV !== 'production') {\n        defineReactive(vm, key, result[key], () => {\n          warn(\n          \t`避免直接改变注入的值，因为将会重新渲染所提供这个值的组件, \n          \t改变的值是: \"${key}\",\n            vm\n          )\n        })\n      } else {\n        defineReactive(vm, key, result[key])\n      }\n    })\n    toggleObserving(true)\n```\n- initState 监听值收集依赖\n```\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props) // 赋值 props 数据并收集依赖\n  if (opts.methods) initMethods(vm, opts.methods) // 赋值 vue 的各个 method\n  if (opts.data) {\n    initData(vm) // 收集依赖\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed) // 收集依赖\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch) // 初始化你写的监听对象\n  }\n \n```\n- initProvide\n```\n  const provide = vm.$options.provide\n  if (provide) {\n    vm._provided = typeof provide === 'function'\n      ? provide.call(vm)\n      : provide\n  }\n```\n-  callHook(vm, 'created') 执行 created 函数\n\n>这就是 _init 中各个函数所做的了。 我们可以看到总结过来就是\n1.初始化了生命状态\n2.进行事件上的监听\n3.渲染视图的初始化；收集所用到的父组件的数据或事件\n4.调用你写的 beforeCreate 方法\n5.initState, 处理了 vue 中的各种数据(props/data/methods.....), 也在这一步针对这些数据进行了依赖收集，数据更新绑定\n6.初始化了 provide 的值， 也可以看出它没有被收集依赖， 是不会影响视图改变的\n7.调用了你写的 created 方法了。\n\n以上，就是你 let app = new Vue() 这一步所发生的所有事情了。\n\n\n那通过平时的使用我们知道，我们是通过调用 $mounted 能把它挂载上页面。所以接下来我们就可以来看看 vue 自己的 $mount 都做了些什么?\n\n答: 就是把 template 或直接写的 render 函数，进行指令、事件等vue 中的语法解析编译成一个 AST 树。通过这个树，通过之前 initRender 中的 $createElement 方法可以生成虚拟DOM, 然后添加到页面中出，不就渲染出来了么。 如果大家使用过 Vue 的 $createElement 方法，相信就知道这个 ast 是怎么一个结构了，拿示例的来说\n```\ncreateElement(\n  'div',\n  [\n    '先写一些文字',\n    createElement('h1', '一则头条'),\n    createElement(MyComponent, {\n      props: {\n        someProp: 'foobar'\n      }\n    })\n  ]\n)\n```\n\n---\n说完了整个过程，现在还比较疑惑的就是它的收集依赖，然后数据改变引起的视图改变到底怎么做呢？\n\n也就是说我们要实现一个模式，vm 可能 data 对象中的一个值，比如 name 改变了，然后就调用重新渲染的函数，这里为了性能，是生成了一个虚拟 Dom, 然后比较哪里改变了进行相应的替换。 \n把这个模式抽象出来，就是我们需要一个 \n\n先说具体实现： 我们视图更新依赖到的值收集起来，这里把每一个依赖到的值称作 dep。每个依赖订阅与它有关的 vue 的 watcher 中心， 这里把 dep 所订阅的 watcher 叫做 sub。 那么 dep 被改变的时候，获取它订阅了那些 watcher， 通知他们进行 update 视图啦。\n\n可以看我画的简图\n![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/417c23088cb0224c6a4464651452c604.png)\n![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/59c0e76f684052df524761ee8f4f6942.png)\n\n这就是依赖对象 和 一个 watcher 对象所涉及到的处理了。\nVue 中又是怎么把一个个的属性，进行操作变成依赖的呢？\n对应它的源码就是 defineReactive 方法。源码如图：\n```\nexport function defineReactive (obj, key, val, customSetter, shallow) {\n  const dep = new Dep()\n  \n  // 迎合预定义的getter / setter\n  const getter = property && property.get\n  const setter = property && property.set\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key]\n  }\n  \n  let childOb = !shallow && observe(val)\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      if (Dep.target) {\n        dep.depend()\n        if (childOb) {\n          childOb.dep.depend()\n          if (Array.isArray(value)) {\n            dependArray(value)\n          }\n        }\n      }\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      const value = getter ? getter.call(obj) : val\n      if (newVal === value || (newVal !== newVal && value !== value)) {\n        return\n      }\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      childOb = !shallow && observe(newVal)\n      dep.notify()\n    }\n  })\n}\n```\n这里就是用的 Object.defineProperty 方法，它可以重写对象的属性的 get 和 set 方法。 当这个属性在 Vue 中被获取的时候，就开始收集依赖，把它收集在这个 vm 的 watcher 中心，并且让它订阅这个 watcher 。当这个属性被重新设置时， 就通知它所订阅的对象去更新。\n\n大致要知道的就是这些了。关于具体是怎么实现把 template  编译成 ast 树， 具体是怎么把事件绑定上去的，你可以尽情的去猜想和推测，或者去看看具体的实现方式。但是 VUE 框架总体来说所做的就是这些事情了, 如果有觉得本文写的不清楚的地方可以提哈 = =\n"}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEyLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoibUlBQUEsdStQIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVhY3Rfd3l6Ly4uLy4uL2Jsb2dzL21hcmtkb3duL3Z1ZS5tZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBcInZ1ZSDmmK/kuIDkuKoganMg5qGG5p6277yM5a6D5a6e546w5LqG6Ieq5bex55qE5qih5p2/77yM6YCa6L+HIC52dWUg5paH5Lu25Y+v5Lul57uP6L+H57yW6K+R5oiQ5LiA5Liq5pWw5o2u5pS55Y+Y6amx5Yqo6KeG5Zu+5pS55Y+Y55qEIGpz5Luj56CB44CCXFxu6YKj5LmI6L+Z5YW25Lit5Y+I5piv57uP5Y6G5LqG5LuA5LmI5qC355qE5q2l6aqk5ZGi77yfXFxuXFxuLS0tLS0gXFxu5LiA5LiqIHZ1ZSDlr7nosaHmmK/pgJrov4cgbmV3IFZ1ZSh7b3B0aW9uc30pIOadpeW+l+WIsOeahO+8jOS5n+WwseaYr+aehOmAoOWHveaVsOS6huOAguaIkeS7rOadpeeci+i/meS4quWHveaVsFxcbmBgYFxcbmZ1bmN0aW9uIFZ1ZSAob3B0aW9ucykge1xcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiZcXG4gICAgISh0aGlzIGluc3RhbmNlb2YgVnVlKVxcbiAgKSB7XFxuICAgIHdhcm4oJ1Z1ZSBpcyBhIGNvbnN0cnVjdG9yIGFuZCBzaG91bGQgYmUgY2FsbGVkIHdpdGggdGhlIGBuZXdgIGtleXdvcmQnKVxcbiAgfVxcbiAgdGhpcy5faW5pdChvcHRpb25zKVxcbn1cXG5cXG4vLyDov5nph4zmmK/kuIDns7vliJflr7nov5nkuKrlh73mlbDov5vooYznmoTnu6fmib9cXG5pbml0TWl4aW4oVnVlKVxcbnN0YXRlTWl4aW4oVnVlKVxcbmV2ZW50c01peGluKFZ1ZSlcXG5saWZlY3ljbGVNaXhpbihWdWUpXFxucmVuZGVyTWl4aW4oVnVlKVxcblxcbmV4cG9ydCBkZWZhdWx0IFZ1ZVxcbmBgYFxcbuWPr+S7peeci+WIsOi/meS4qiBWdWUg5p6E6YCg5Ye95pWw77yM5a6D57uP5Y6G5LqGIDUg5Liq57O75YiX55qEbWl4aW7vvIzlubblnKjmlrDliJvlu7rml7bkvJrov5DooYwgX2luaXQob3B0aW9ucykg5pa55rOV44CCXFxu6YKj5LmI5oiR5Lus5p2l55yL55yLLCDov5nkupTkuKogbWl4aW4g5YiG5Yir5YGa5LqG5ZWl44CCXFxuXFxuICMjIyMjIOesrOS4gOS4qiAgaW5pdE1peGluXFxuIOWug+WPquWBmuS6huS4gOS7tuS6i++8jCDlrprkuYnkuoYgX2luaXQg5pa55rOV77yM6YKj5LmI5L2g5bCx55+l6YGT5Yib6YCg5LiA5LiqVnVlIOWunuS+i++8jOWug+aJp+ihjOeahCBfaW5pdCDmlrnms5XlsLHmmK/kuIrpnaLov5nkuKrmlrnms5XkuobjgIJcXG5gYGBcXG5WdWUucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24gKG9wdGlvbnM/OiBPYmplY3QpIHtcXG4uLi4uXFxufVxcbmBgYFxcblxcblxcblxcbiMjIyMjIOesrOS6jOS4qiBzdGF0ZU1peGluIFxcbmBgYFxcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckZGF0YScsIGRhdGFEZWYpICAvLyDog73lpJ/ov5Tlm54gZGF0YVxcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckcHJvcHMnLCBwcm9wc0RlZikgLy8g6IO95aSf6L+U5ZueIHByb3BzXFxuICBWdWUucHJvdG90eXBlLiRzZXQgPSBzZXQgLy8g5bCx5piv5oiR5Lus55So55qEIHRoaXMuJHNldCh0aGlzLnBlb3BsZSwgJ25hbWUnLCDigJhjbGV2ZXInKeaWueazlSwg5LiL5ZCM44CCXFxuICBWdWUucHJvdG90eXBlLiRkZWxldGUgPSBkZWxcXG4gIFZ1ZS5wcm90b3R5cGUuJHdhdGNoID0gZnVuY3Rpb24gKFxcbiAgIC4uLi5cXG4gIH1cXG4gIGBgYFxcblxcbiMjIyMjIOesrOS4ieS4qiBldmVudHNNaXhpblxcbmBgYFxcblZ1ZS5wcm90b3R5cGUuJG9uID0gZnVuY3Rpb24gKGV2ZW50bmFtZSwgZm4pIHtcXG4uLi4uXFxufVxcblZ1ZS5wcm90b3R5cGUuXyRvbmNlID0gZnVuY3Rpb24gKGV2ZW50bmFtZSwgZm4pIHtcXG4gLy8g55uR5ZCs5LiA5Liq6Ieq5a6a5LmJ5LqL5Lu277yM5L2G5piv5Y+q6Kem5Y+R5LiA5qyh77yM5Zyo56ys5LiA5qyh6Kem5Y+R5LmL5ZCO56e76Zmk55uR5ZCs5Zmo44CCXFxufVxcblZ1ZS5wcm90b3R5cGUuX29mZiA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHtcXG4vLyDnp7vpmaToh6rlrprkuYnkuovku7bnm5HlkKzlmajjgIJcXG59XFxuVnVlLnByb3RvdHlwZS4kZW1pdCA9IGZ1bmN0aW9uIChldmVudCkge1xcbi8vIOinpuWPkeS4gOS4quS6i+S7tlxcbn1cXG5gYGBcXG4jIyMjIyDnrKzlm5vkuKogbGlmZWN5Y2xlTWl4aW4hW+WcqOi/memHjOaPkuWFpeWbvueJh+aPj+i/sF0oaHR0cHM6Ly9pLWJsb2cuY3NkbmltZy5jbi9ibG9nX21pZ3JhdGUvMDIyN2M4YzE1Mjg1ZmJkMTc5NTczZTdjZDhjYjQ3MTgucG5nKVxcbiMjIyMjIOesrOS6lOS4qiByZW5kZXJNaXhpbiFb5Zyo6L+Z6YeM5o+S5YWl5Zu+54mH5o+P6L+wXShodHRwczovL2ktYmxvZy5jc2RuaW1nLmNuL2Jsb2dfbWlncmF0ZS83MTUzOTlhOWFjMzVjZWY3YzNhY2EyZDMyNDJjYTVhMy5wbmcpXFxuLS0tXFxuXFxu5aW977yMIOi/meS4qiBWdWUg57un5om/5LqG6L+Z5Lqb5pa55rOV77yM5a6D5bey57uP5piv5LiA5Liq5a6M5pW055qEIFZ1ZSDkuobvvIzogIzmlrDliJvlu7rnmoTml7blgJnopoHmiafooYwgX2luaXQg5pa55rOV5LqGLCDnjrDlnKjmiJHku6zmnaXnnIvnnIvov5nkuKrmlrnms5Xph4zpnaLlgZrkuoblhpnllaVcXG4tICB2bS5fdWlkID0gdWlkKysg5Yib5bu6IHVpZFxcbi0gIOWQiOW5tiBvcHRpb25zXFxuLSAgIGluaXRMaWZlY3ljbGVcXG4gICAgaW5pdEV2ZW50cyh2bSlcXG4gICAgaW5pdFJlbmRlcih2bSlcXG4gICAgY2FsbEhvb2sodm0sICdiZWZvcmVDcmVhdGUnKVxcbiAgICBpbml0SW5qZWN0aW9ucyh2bSkgLy8gcmVzb2x2ZSBpbmplY3Rpb25zIGJlZm9yZSBkYXRhL3Byb3BzXFxuICAgIGluaXRTdGF0ZSh2bSlcXG4gICAgaW5pdFByb3ZpZGUodm0pIC8vIHJlc29sdmUgcHJvdmlkZSBhZnRlciBkYXRhL3Byb3BzXFxuICAgIGNhbGxIb29rKHZtLCAnY3JlYXRlZCcpXFxuYGBgXFxu5YWz5LqOIGluaXRMaWZlY3ljbGVcXG4gIHZtLiRwYXJlbnQgPSBwYXJlbnRcXG4gIHZtLiRyb290ID0gcGFyZW50ID8gcGFyZW50LiRyb290IDogdm1cXG4gIHZtLiRjaGlsZHJlbiA9IFtdXFxuICB2bS4kcmVmcyA9IHt9XFxuICB2bS5fd2F0Y2hlciA9IG51bGxcXG4gIHZtLl9pbmFjdGl2ZSA9IG51bGxcXG4gIHZtLl9kaXJlY3RJbmFjdGl2ZSA9IGZhbHNlXFxuICB2bS5faXNNb3VudGVkID0gZmFsc2VcXG4gIHZtLl9pc0Rlc3Ryb3llZCA9IGZhbHNlXFxuICB2bS5faXNCZWluZ0Rlc3Ryb3llZCA9IGZhbHNlXFxuICBgYGBcXG5cXG4tICBpbml0RXZlbnRzXFxuYGBgXFxuICB2bS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKVxcbiAgdm0uX2hhc0hvb2tFdmVudCA9IGZhbHNlXFxuICAvLyBpbml0IHBhcmVudCBhdHRhY2hlZCBldmVudHNcXG4gIGNvbnN0IGxpc3RlbmVycyA9IHZtLiRvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnNcXG4gIGlmIChsaXN0ZW5lcnMpIHtcXG4gICAgdXBkYXRlQ29tcG9uZW50TGlzdGVuZXJzKHZtLCBsaXN0ZW5lcnMpXFxuICB9XFxuICDlsLHmmK/liKTmlq3niLbnuqfmmK/lkKbmnInkuovku7bnm5HlkKzvvIznhLblkI7nu5nniLbnuqfov5vooYznm5HlkKzkuovku7ZcXG4gIGBgYFxcbi0gaW5pdFJlbmRlclxcbmBgYFxcbiAgIHZtLl92bm9kZSA9IG51bGwgIC8vIHRoZSByb290IG9mIHRoZSBjaGlsZCB0cmVlXFxuICB2bS5fc3RhdGljVHJlZXMgPSBudWxsICAvLyB2LW9uY2UgY2FjaGVkIHRyZWVzXFxuICBjb25zdCBvcHRpb25zID0gdm0uJG9wdGlvbnNcXG4gIGNvbnN0IHBhcmVudFZub2RlID0gdm0uJHZub2RlID0gb3B0aW9ucy5fcGFyZW50Vm5vZGUgLy8gdGhlIHBsYWNlaG9sZGVyIG5vZGUgaW4gcGFyZW50IHRyZWVcXG4gIGNvbnN0IHJlbmRlckNvbnRleHQgPSBwYXJlbnRWbm9kZSAmJiBwYXJlbnRWbm9kZS5jb250ZXh0XFxuICB2bS4kc2xvdHMgPSByZXNvbHZlU2xvdHMob3B0aW9ucy5fcmVuZGVyQ2hpbGRyZW4sIHJlbmRlckNvbnRleHQpXFxuICB2bS4kc2NvcGVkU2xvdHMgPSBlbXB0eU9iamVjdFxcbiAgLy8g5a6e5L6L57uR5a6aIGNyZWF0ZUVsZW1lbnQg5pa55rOV77yM5Lul5L6/5Y+v5Lul5q2j5bi45Zyo5YaF6YOo5riy5p+TXFxuIC8vIOWPguaVsOmhuuW6jyAgIHRhZywgZGF0YSwgY2hpbGRyZW4sIG5vcm1hbGl6YXRpb25UeXBlLCBhbHdheXNOb3JtYWxpemVcXG4gIC8vIOWGhemDqOS9v+eUqOS7juaooeadv+e8luivkeiAjOadpeeahOa4suafk+WHveaVsFxcbiAgXFxuICB2bS5fYyA9IChhLCBiLCBjLCBkKSA9PiBjcmVhdGVFbGVtZW50KHZtLCBhLCBiLCBjLCBkLCBmYWxzZSlcXG4gIC8vIOWFrOWFseeJiOacrOW/hemhu+aYryBub3JtYWxpemF0aW9uIOeahOa4suafk+WHveaVsFxcbiAgdm0uJGNyZWF0ZUVsZW1lbnQgPSAoYSwgYiwgYywgZCkgPT4gY3JlYXRlRWxlbWVudCh2bSwgYSwgYiwgYywgZCwgdHJ1ZSlcXG5cXG4gIC8vICRhdHRycyAmICRsaXN0ZW5lcnMg5bqU6K+l6KKr55uR5ZCs54Ot5pu05pawXFxuICBjb25zdCBwYXJlbnREYXRhID0gcGFyZW50Vm5vZGUgJiYgcGFyZW50Vm5vZGUuZGF0YVxcblxcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcXG4gICAgZGVmaW5lUmVhY3RpdmUodm0sICckYXR0cnMnLCBwYXJlbnREYXRhICYmIHBhcmVudERhdGEuYXR0cnMgfHwgZW1wdHlPYmplY3QsICgpID0+IHtcXG4gICAgICAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ICYmIHdhcm4oYCRhdHRycyBpcyByZWFkb25seS5gLCB2bSlcXG4gICAgfSwgdHJ1ZSlcXG4gICAgZGVmaW5lUmVhY3RpdmUodm0sICckbGlzdGVuZXJzJywgb3B0aW9ucy5fcGFyZW50TGlzdGVuZXJzIHx8IGVtcHR5T2JqZWN0LCAoKSA9PiB7XFxuICAgICAgIWlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCAmJiB3YXJuKGAkbGlzdGVuZXJzIGlzIHJlYWRvbmx5LmAsIHZtKVxcbiAgICB9LCB0cnVlKVxcbiAgfSBlbHNlIHtcXG4gICAgZGVmaW5lUmVhY3RpdmUodm0sICckYXR0cnMnLCBwYXJlbnREYXRhICYmIHBhcmVudERhdGEuYXR0cnMgfHwgZW1wdHlPYmplY3QsIG51bGwsIHRydWUpXFxuICAgIGRlZmluZVJlYWN0aXZlKHZtLCAnJGxpc3RlbmVycycsIG9wdGlvbnMuX3BhcmVudExpc3RlbmVycyB8fCBlbXB0eU9iamVjdCwgbnVsbCwgdHJ1ZSlcXG4gIH1cXG4gIGBgYFxcbi0gIGNhbGxIb29rKHZtLCAnYmVmb3JlQ3JlYXRlJykg5omn6KGMIGJlZm9yZUNyZWF0ZSDlh73mlbBcXG5cXG4tICBpbml0SW5qZWN0aW9ucyh2bSkg5pS26ZuG5rOo5YWl55qE5L6d6LWWXFxuYGBgXFxuICBjb25zdCByZXN1bHQgPSByZXNvbHZlSW5qZWN0KHZtLiRvcHRpb25zLmluamVjdCwgdm0pXFxuICBpZiAocmVzdWx0KSB7XFxuICAgIHRvZ2dsZU9ic2VydmluZyhmYWxzZSlcXG4gICAgT2JqZWN0LmtleXMocmVzdWx0KS5mb3JFYWNoKGtleSA9PiB7XFxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcXG4gICAgICAgIGRlZmluZVJlYWN0aXZlKHZtLCBrZXksIHJlc3VsdFtrZXldLCAoKSA9PiB7XFxuICAgICAgICAgIHdhcm4oXFxuICAgICAgICAgIFxcdGDpgb/lhY3nm7TmjqXmlLnlj5jms6jlhaXnmoTlgLzvvIzlm6DkuLrlsIbkvJrph43mlrDmuLLmn5PmiYDmj5Dkvpvov5nkuKrlgLznmoTnu4Tku7YsIFxcbiAgICAgICAgICBcXHTmlLnlj5jnmoTlgLzmmK86IFxcXCIke2tleX1cXFwiLFxcbiAgICAgICAgICAgIHZtXFxuICAgICAgICAgIClcXG4gICAgICAgIH0pXFxuICAgICAgfSBlbHNlIHtcXG4gICAgICAgIGRlZmluZVJlYWN0aXZlKHZtLCBrZXksIHJlc3VsdFtrZXldKVxcbiAgICAgIH1cXG4gICAgfSlcXG4gICAgdG9nZ2xlT2JzZXJ2aW5nKHRydWUpXFxuYGBgXFxuLSBpbml0U3RhdGUg55uR5ZCs5YC85pS26ZuG5L6d6LWWXFxuYGBgXFxuICB2bS5fd2F0Y2hlcnMgPSBbXVxcbiAgY29uc3Qgb3B0cyA9IHZtLiRvcHRpb25zXFxuICBpZiAob3B0cy5wcm9wcykgaW5pdFByb3BzKHZtLCBvcHRzLnByb3BzKSAvLyDotYvlgLwgcHJvcHMg5pWw5o2u5bm25pS26ZuG5L6d6LWWXFxuICBpZiAob3B0cy5tZXRob2RzKSBpbml0TWV0aG9kcyh2bSwgb3B0cy5tZXRob2RzKSAvLyDotYvlgLwgdnVlIOeahOWQhOS4qiBtZXRob2RcXG4gIGlmIChvcHRzLmRhdGEpIHtcXG4gICAgaW5pdERhdGEodm0pIC8vIOaUtumbhuS+nei1llxcbiAgfSBlbHNlIHtcXG4gICAgb2JzZXJ2ZSh2bS5fZGF0YSA9IHt9LCB0cnVlIC8qIGFzUm9vdERhdGEgKi8pXFxuICB9XFxuICBpZiAob3B0cy5jb21wdXRlZCkgaW5pdENvbXB1dGVkKHZtLCBvcHRzLmNvbXB1dGVkKSAvLyDmlLbpm4bkvp3otZZcXG4gIGlmIChvcHRzLndhdGNoICYmIG9wdHMud2F0Y2ggIT09IG5hdGl2ZVdhdGNoKSB7XFxuICAgIGluaXRXYXRjaCh2bSwgb3B0cy53YXRjaCkgLy8g5Yid5aeL5YyW5L2g5YaZ55qE55uR5ZCs5a+56LGhXFxuICB9XFxuIFxcbmBgYFxcbi0gaW5pdFByb3ZpZGVcXG5gYGBcXG4gIGNvbnN0IHByb3ZpZGUgPSB2bS4kb3B0aW9ucy5wcm92aWRlXFxuICBpZiAocHJvdmlkZSkge1xcbiAgICB2bS5fcHJvdmlkZWQgPSB0eXBlb2YgcHJvdmlkZSA9PT0gJ2Z1bmN0aW9uJ1xcbiAgICAgID8gcHJvdmlkZS5jYWxsKHZtKVxcbiAgICAgIDogcHJvdmlkZVxcbiAgfVxcbmBgYFxcbi0gIGNhbGxIb29rKHZtLCAnY3JlYXRlZCcpIOaJp+ihjCBjcmVhdGVkIOWHveaVsFxcblxcbj7ov5nlsLHmmK8gX2luaXQg5Lit5ZCE5Liq5Ye95pWw5omA5YGa55qE5LqG44CCIOaIkeS7rOWPr+S7peeci+WIsOaAu+e7k+i/h+adpeWwseaYr1xcbjEu5Yid5aeL5YyW5LqG55Sf5ZG954q25oCBXFxuMi7ov5vooYzkuovku7bkuIrnmoTnm5HlkKxcXG4zLua4suafk+inhuWbvueahOWIneWni+WMlu+8m+aUtumbhuaJgOeUqOWIsOeahOeItue7hOS7tueahOaVsOaNruaIluS6i+S7tlxcbjQu6LCD55So5L2g5YaZ55qEIGJlZm9yZUNyZWF0ZSDmlrnms5VcXG41LmluaXRTdGF0ZSwg5aSE55CG5LqGIHZ1ZSDkuK3nmoTlkITnp43mlbDmja4ocHJvcHMvZGF0YS9tZXRob2RzLi4uLi4pLCDkuZ/lnKjov5nkuIDmraXpkojlr7nov5nkupvmlbDmja7ov5vooYzkuobkvp3otZbmlLbpm4bvvIzmlbDmja7mm7TmlrDnu5HlrppcXG42LuWIneWni+WMluS6hiBwcm92aWRlIOeahOWAvO+8jCDkuZ/lj6/ku6XnnIvlh7rlroPmsqHmnInooqvmlLbpm4bkvp3otZbvvIwg5piv5LiN5Lya5b2x5ZON6KeG5Zu+5pS55Y+Y55qEXFxuNy7osIPnlKjkuobkvaDlhpnnmoQgY3JlYXRlZCDmlrnms5XkuobjgIJcXG5cXG7ku6XkuIrvvIzlsLHmmK/kvaAgbGV0IGFwcCA9IG5ldyBWdWUoKSDov5nkuIDmraXmiYDlj5HnlJ/nmoTmiYDmnInkuovmg4XkuobjgIJcXG5cXG5cXG7pgqPpgJrov4flubPml7bnmoTkvb/nlKjmiJHku6znn6XpgZPvvIzmiJHku6zmmK/pgJrov4fosIPnlKggJG1vdW50ZWQg6IO95oqK5a6D5oyC6L295LiK6aG16Z2i44CC5omA5Lul5o6l5LiL5p2l5oiR5Lus5bCx5Y+v5Lul5p2l55yL55yLIHZ1ZSDoh6rlt7HnmoQgJG1vdW50IOmDveWBmuS6huS6m+S7gOS5iD9cXG5cXG7nrZQ6IOWwseaYr+aKiiB0ZW1wbGF0ZSDmiJbnm7TmjqXlhpnnmoQgcmVuZGVyIOWHveaVsO+8jOi/m+ihjOaMh+S7pOOAgeS6i+S7tuetiXZ1ZSDkuK3nmoTor63ms5Xop6PmnpDnvJbor5HmiJDkuIDkuKogQVNUIOagkeOAgumAmui/h+i/meS4quagke+8jOmAmui/h+S5i+WJjSBpbml0UmVuZGVyIOS4reeahCAkY3JlYXRlRWxlbWVudCDmlrnms5Xlj6/ku6XnlJ/miJDomZrmi59ET00sIOeEtuWQjua3u+WKoOWIsOmhtemdouS4reWHuu+8jOS4jeWwsea4suafk+WHuuadpeS6huS5iOOAgiDlpoLmnpzlpKflrrbkvb/nlKjov4cgVnVlIOeahCAkY3JlYXRlRWxlbWVudCDmlrnms5XvvIznm7jkv6HlsLHnn6XpgZPov5nkuKogYXN0IOaYr+aAjuS5iOS4gOS4que7k+aehOS6hu+8jOaLv+ekuuS+i+eahOadpeivtFxcbmBgYFxcbmNyZWF0ZUVsZW1lbnQoXFxuICAnZGl2JyxcXG4gIFtcXG4gICAgJ+WFiOWGmeS4gOS6m+aWh+WtlycsXFxuICAgIGNyZWF0ZUVsZW1lbnQoJ2gxJywgJ+S4gOWImeWktOadoScpLFxcbiAgICBjcmVhdGVFbGVtZW50KE15Q29tcG9uZW50LCB7XFxuICAgICAgcHJvcHM6IHtcXG4gICAgICAgIHNvbWVQcm9wOiAnZm9vYmFyJ1xcbiAgICAgIH1cXG4gICAgfSlcXG4gIF1cXG4pXFxuYGBgXFxuXFxuLS0tXFxu6K+05a6M5LqG5pW05Liq6L+H56iL77yM546w5Zyo6L+Y5q+U6L6D55aR5oOR55qE5bCx5piv5a6D55qE5pS26ZuG5L6d6LWW77yM54S25ZCO5pWw5o2u5pS55Y+Y5byV6LW355qE6KeG5Zu+5pS55Y+Y5Yiw5bqV5oCO5LmI5YGa5ZGi77yfXFxuXFxu5Lmf5bCx5piv6K+05oiR5Lus6KaB5a6e546w5LiA5Liq5qih5byP77yMdm0g5Y+v6IO9IGRhdGEg5a+56LGh5Lit55qE5LiA5Liq5YC877yM5q+U5aaCIG5hbWUg5pS55Y+Y5LqG77yM54S25ZCO5bCx6LCD55So6YeN5paw5riy5p+T55qE5Ye95pWw77yM6L+Z6YeM5Li65LqG5oCn6IO977yM5piv55Sf5oiQ5LqG5LiA5Liq6Jma5oufIERvbSwg54S25ZCO5q+U6L6D5ZOq6YeM5pS55Y+Y5LqG6L+b6KGM55u45bqU55qE5pu/5o2i44CCIFxcbuaKiui/meS4quaooeW8j+aKveixoeWHuuadpe+8jOWwseaYr+aIkeS7rOmcgOimgeS4gOS4qiBcXG5cXG7lhYjor7TlhbfkvZPlrp7njrDvvJog5oiR5Lus6KeG5Zu+5pu05paw5L6d6LWW5Yiw55qE5YC85pS26ZuG6LW35p2l77yM6L+Z6YeM5oqK5q+P5LiA5Liq5L6d6LWW5Yiw55qE5YC856ew5L2cIGRlcOOAguavj+S4quS+nei1luiuoumYheS4juWug+acieWFs+eahCB2dWUg55qEIHdhdGNoZXIg5Lit5b+D77yMIOi/memHjOaKiiBkZXAg5omA6K6i6ZiF55qEIHdhdGNoZXIg5Y+r5YGaIHN1YuOAgiDpgqPkuYggZGVwIOiiq+aUueWPmOeahOaXtuWAme+8jOiOt+WPluWug+iuoumYheS6humCo+S6myB3YXRjaGVy77yMIOmAmuefpeS7luS7rOi/m+ihjCB1cGRhdGUg6KeG5Zu+5ZWm44CCXFxuXFxu5Y+v5Lul55yL5oiR55S755qE566A5Zu+XFxuIVvlnKjov5nph4zmj5LlhaXlm77niYfmj4/ov7BdKGh0dHBzOi8vaS1ibG9nLmNzZG5pbWcuY24vYmxvZ19taWdyYXRlLzQxN2MyMzA4OGNiMDIyNGM2YTQ0NjQ2NTE0NTJjNjA0LnBuZylcXG4hW+WcqOi/memHjOaPkuWFpeWbvueJh+aPj+i/sF0oaHR0cHM6Ly9pLWJsb2cuY3NkbmltZy5jbi9ibG9nX21pZ3JhdGUvNTljMGU3NmY2ODQwNTJkZjUyNDc2MWVlOGY0ZjY5NDIucG5nKVxcblxcbui/meWwseaYr+S+nei1luWvueixoSDlkowg5LiA5LiqIHdhdGNoZXIg5a+56LGh5omA5raJ5Y+K5Yiw55qE5aSE55CG5LqG44CCXFxuVnVlIOS4reWPiOaYr+aAjuS5iOaKiuS4gOS4quS4queahOWxnuaAp++8jOi/m+ihjOaTjeS9nOWPmOaIkOS+nei1lueahOWRou+8n1xcbuWvueW6lOWug+eahOa6kOeggeWwseaYryBkZWZpbmVSZWFjdGl2ZSDmlrnms5XjgILmupDnoIHlpoLlm77vvJpcXG5gYGBcXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lUmVhY3RpdmUgKG9iaiwga2V5LCB2YWwsIGN1c3RvbVNldHRlciwgc2hhbGxvdykge1xcbiAgY29uc3QgZGVwID0gbmV3IERlcCgpXFxuICBcXG4gIC8vIOi/juWQiOmihOWumuS5ieeahGdldHRlciAvIHNldHRlclxcbiAgY29uc3QgZ2V0dGVyID0gcHJvcGVydHkgJiYgcHJvcGVydHkuZ2V0XFxuICBjb25zdCBzZXR0ZXIgPSBwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5zZXRcXG4gIGlmICgoIWdldHRlciB8fCBzZXR0ZXIpICYmIGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcXG4gICAgdmFsID0gb2JqW2tleV1cXG4gIH1cXG4gIFxcbiAgbGV0IGNoaWxkT2IgPSAhc2hhbGxvdyAmJiBvYnNlcnZlKHZhbClcXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxcbiAgICBjb25maWd1cmFibGU6IHRydWUsXFxuICAgIGdldDogZnVuY3Rpb24gcmVhY3RpdmVHZXR0ZXIgKCkge1xcbiAgICAgIGNvbnN0IHZhbHVlID0gZ2V0dGVyID8gZ2V0dGVyLmNhbGwob2JqKSA6IHZhbFxcbiAgICAgIGlmIChEZXAudGFyZ2V0KSB7XFxuICAgICAgICBkZXAuZGVwZW5kKClcXG4gICAgICAgIGlmIChjaGlsZE9iKSB7XFxuICAgICAgICAgIGNoaWxkT2IuZGVwLmRlcGVuZCgpXFxuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xcbiAgICAgICAgICAgIGRlcGVuZEFycmF5KHZhbHVlKVxcbiAgICAgICAgICB9XFxuICAgICAgICB9XFxuICAgICAgfVxcbiAgICAgIHJldHVybiB2YWx1ZVxcbiAgICB9LFxcbiAgICBzZXQ6IGZ1bmN0aW9uIHJlYWN0aXZlU2V0dGVyIChuZXdWYWwpIHtcXG4gICAgICBjb25zdCB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWxcXG4gICAgICBpZiAobmV3VmFsID09PSB2YWx1ZSB8fCAobmV3VmFsICE9PSBuZXdWYWwgJiYgdmFsdWUgIT09IHZhbHVlKSkge1xcbiAgICAgICAgcmV0dXJuXFxuICAgICAgfVxcbiAgICAgIGlmIChzZXR0ZXIpIHtcXG4gICAgICAgIHNldHRlci5jYWxsKG9iaiwgbmV3VmFsKVxcbiAgICAgIH0gZWxzZSB7XFxuICAgICAgICB2YWwgPSBuZXdWYWxcXG4gICAgICB9XFxuICAgICAgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUobmV3VmFsKVxcbiAgICAgIGRlcC5ub3RpZnkoKVxcbiAgICB9XFxuICB9KVxcbn1cXG5gYGBcXG7ov5nph4zlsLHmmK/nlKjnmoQgT2JqZWN0LmRlZmluZVByb3BlcnR5IOaWueazle+8jOWug+WPr+S7pemHjeWGmeWvueixoeeahOWxnuaAp+eahCBnZXQg5ZKMIHNldCDmlrnms5XjgIIg5b2T6L+Z5Liq5bGe5oCn5ZyoIFZ1ZSDkuK3ooqvojrflj5bnmoTml7blgJnvvIzlsLHlvIDlp4vmlLbpm4bkvp3otZbvvIzmiorlroPmlLbpm4blnKjov5nkuKogdm0g55qEIHdhdGNoZXIg5Lit5b+D77yM5bm25LiU6K6p5a6D6K6i6ZiF6L+Z5LiqIHdhdGNoZXIg44CC5b2T6L+Z5Liq5bGe5oCn6KKr6YeN5paw6K6+572u5pe277yMIOWwsemAmuefpeWug+aJgOiuoumYheeahOWvueixoeWOu+abtOaWsOOAglxcblxcbuWkp+iHtOimgeefpemBk+eahOWwseaYr+i/meS6m+S6huOAguWFs+S6juWFt+S9k+aYr+aAjuS5iOWunueOsOaKiiB0ZW1wbGF0ZSAg57yW6K+R5oiQIGFzdCDmoJHvvIwg5YW35L2T5piv5oCO5LmI5oqK5LqL5Lu257uR5a6a5LiK5Y6755qE77yM5L2g5Y+v5Lul5bC95oOF55qE5Y6754yc5oOz5ZKM5o6o5rWL77yM5oiW6ICF5Y6755yL55yL5YW35L2T55qE5a6e546w5pa55byP44CC5L2G5pivIFZVRSDmoYbmnrbmgLvkvZPmnaXor7TmiYDlgZrnmoTlsLHmmK/ov5nkupvkuovmg4XkuoYsIOWmguaenOacieinieW+l+acrOaWh+WGmeeahOS4jea4healmueahOWcsOaWueWPr+S7peaPkOWTiCA9ID1cXG5cIjsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=